### 项目介绍
明确项目是做什么的。
P2P互联网金融里的贷款系统
明确项目的价值。
对借款人来说是方便了贷款，只需通过app操作即可完成网络贷款，综合第三方信息确定用户资质，控制风险。
**明确项目的功能**
主要分:
- 贷前(用户借款申请准入,额度授信、预发标、视频签约、正式标)、
- 贷中(自动审核、人工初审、人工终审、流标、推标、放款、生成还款计划、协议电子签章)
- 贷后(还款、系统代偿、逾期金额维护、还款提醒)

**明确项目的技术**
![](https://i.loli.net/2018/03/24/5ab62dea06a0a.png)
- 定时任务执行 TbSchedule
- 消息通信 RocketMQ
- 配置中心
- Redis集群 Codis
- 系统监控 Cat
- 业务监控 查询SQL 邮件报警
- 分布式锁 Redis实现

**明确个人在项目中的位置和作用**
岗位职责：贷款系统接口设计、文档编写、代码开发、代码review、对接架构部中间件使用以及技术分享。
责任描述：负责协议电子签章、咨询费模块开发自测、主要包括生成pdf协议、协议签章、咨询费逾期扣除、后台退还等功能。

**明确项目的整体架构**
一般采用分层的
- 端 App Web 公众号 等通过nodejs 访问后台 经过Nginx 负载均衡
- 业务系统 贷款 理财 用户 产品
- 基础服务 比如邮件、短信、脸纹、电子签章
- 数据存储 mysql redis缓存 ceph 存储文件

下面几张图参考下,
![](https://i.loli.net/2018/03/25/5ab70fe0a3315.png)
今日头条架构图：
![今日头条架构图](https://i.loli.net/2018/03/25/5ab7117d3a8d4.png)

**明确项目的亮点**
中间件的应用 业务监控的完善

**明确技术成长**
- 接口幂等
- 并发控制


### Java并发
CAS
缺点：
1.  ABA问题。因为CAS需要在操作值的时候检查下值有没有发生变化，如果没有发生变化则更新，但是如果一个值原来是A，变成了B，又变成了A，那么使用CAS进行检查时会发现它的值没有发生变化，但是实际上却变化了。ABA问题的解决思路就是使用版本号。在变量前面追加上版本号，每次变量更新的时候把版本号加一，那么A－B－A 就会变成1A-2B－3A。

从Java1.5开始JDK的atomic包里提供了一个类AtomicStampedReference来解决ABA问题。这个类的compareAndSet方法作用是首先检查当前引用是否等于预期引用，并且当前标志是否等于预期标志，如果全部相等，则以原子方式将该引用和该标志的值设置为给定的更新值。
2. 循环时间长开销大。自旋CAS如果长时间不成功，会给CPU带来非常大的执行开销。如果JVM能支持处理器提供的pause指令那么效率会有一定的提升，pause指令有两个作用，第一它可以延迟流水线执行指令（de-pipeline）,使CPU不会消耗过多的执行资源，延迟的时间取决于具体实现的版本，在一些处理器上延迟时间是零。第二它可以避免在退出循环的时候因内存顺序冲突（memory order violation）而引起CPU流水线被清空（CPU pipeline flush），从而提高CPU的执行效率
3. 只能保证一个共享变量的原子操作。当对一个共享变量执行操作时，我们可以使用循环CAS的方式来保证原子操作，但是对多个共享变量操作时，循环CAS就无法保证操作的原子性，这个时候就可以用锁，或者有一个取巧的办法，就是把多个共享变量合并成一个共享变量来操作。比如有两个共享变量i＝2,j=a，合并一下ij=2a，然后用CAS来操作ij。从Java1.5开始JDK提供了AtomicReference类来保证引用对象之间的原子性，你可以把多个变量放在一个对象里来进行CAS操作
